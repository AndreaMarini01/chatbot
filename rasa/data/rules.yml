version: "3.1"
rules:
  - rule: respond to goodbye
    steps:
      - intent: goodbye
      - action: utter_goodbye

  - rule: Imposta contesto ricerca per film
    steps:
      - intent: cerca_film_titolo
      - action: action_set_context_title
      - action: action_movie_details

  - rule: Imposta contesto ricerca per serie
    steps:
      - intent: cerca_serieTV_titolo
      - action: action_set_context_title
      - action: action_TV_details

  - rule: Fallback solo se in contesto titolo
    condition:
      - slot_was_set:
          - context_ricerca: "title"
    steps:
      - intent: nlu_fallback
      - action: action_ask_movie_or_series
  - rule: Regola per serie TV popolari
    steps:
      - intent: popolarità_serieTV
      - action: popular_TV


  - rule: Utente dice che è una serie
    steps:
      - intent: inform_serie
      - slot_was_set:
          - tipo_contenuto: "serie"
      - action: action_TV_details  # se già abbiamo titolo_s

  - rule: Utente dice che è un film
    steps:
      - intent: inform_film
      - slot_was_set:
          - tipo_contenuto: "film"
      - action: action_movie_details  # se già abbiamo titolo_film

  - rule : Attivazione Form film
    steps:
      - intent : cerca_film_titolo2
      - action : validate_form_film
      - active_loop : validate_form_film

  - rule : Invio Form film
    condition:
      - active_loop: validate_form_film
    steps:
      - action: validate_form_film
      - active_loop: null
#      - slot_was_set:
#          - request_slot : null
      - action: utter_submit
      - action: utter_film_slot

#  - rule: Cerca serie TV per genere
#    steps:
#      - intent: cerca_serieTV_genere
#      - slot_was_set:
#          - tipo_contenuto: "serie"
#      - action: TV_by_genre
